import React, { useEffect, useState } from 'react'
import { motion } from 'framer-motion'
import api from '../config/axios'
import L_loader from './L_loader'
import { useDispatch, useSelector } from 'react-redux'
import { add_following_in_local, remove_following_in_local } from '../slices/userSlice'
function Btn_follow({ user_id, className }) {
    const { following, followers } = useSelector(s => s.User);
    const [isFollowing, setFollowing] = useState(following.includes(user_id))
    const [isIsLodingFollo, setIsLodingFollo] = useState(false)
    const dispatch = useDispatch()
    const handelAddFollowing = async (e) => {
        e.target.disabled = true
        setIsLodingFollo(true);
        await api.post('/user/add_follwing_relation', { following_user_id: user_id }).then(res => {
            setFollowing(true);
            dispatch(add_following_in_local(user_id))
            setIsLodingFollo(false);
        }).catch(err => console.log(err))
    }
    const handelCancelFollowing = async (e) => {
        e.target.disabled = true
        setIsLodingFollo(true);
        await api.post('/user/remove_follwing_relation', { following_user_id: user_id }).then(res => {
            setFollowing(false);
            dispatch(remove_following_in_local(user_id))
            setIsLodingFollo(false);
        }).catch(err => console.log(err))
    }
    useEffect(() => {
        setFollowing(following.includes(user_id))
    }, [following])

    return (
        <>
            {
                isFollowing ?
                    <>     <motion.button
                        // animate={{
                        //     y:[10 ,-10 ,0],
                        // }}
                        className={` ${className}`}
                        style={{

                            cursor: "pointer",
                            // border: className == "c-rl" ? "solid 1px #ffffff9f" : "solid 1px var(--border-color)",
                            transition: '.1s'
                        }}
                        onClick={handelCancelFollowing}
                    >
                        {
                            isIsLodingFollo ?
                                <L_loader />
                                :
                                <>

                                    Following
                                    <svg version="1.1" viewBox="0 0 2048 2048" className='ml10' xmlns="http://www.w3.org/2000/svg">
                                        <path transform="translate(1494)" d="m0 0h181v5l-4-1-1 2-2-2-7 1-2 3 18 4 24 7 32 11 20 9 23 12 27 16 19 14 16 13 11 9 13 12 16 16 9 11 9 10 9 12 13 18 16 27 15 29 8 19 7 19 12 44 4 22 6 56v14l-2 19-5 50-4 19-13 42-9 24-9 20-10 18-9 15-6 11-11 16-7 9-11 13-7 8-11 13-6 7-5 4-4 8 4 3 25 10 39 19 22 12 28 17 15 9 16 11 14 12 7 7 9 13 8 13 2 6 2-1v39l-2-1-8 16-6 10-11 13-10 8-16 8-21 7-7-1-2 2-7-1-7-2-13-4-19-9-18-10-25-15-19-11-27-14-39-16-35-13-18-5-46-11-26-5-43-4-25-2h-38l-56 5-40 5-26 6-55 16-26 9-21 9-22 11-22 12-21 11-19 11-14 10-22 18-18 14-11 9-13 10-8 6-6 11-3 8-6 36-6 26-11 33-12 29-8 17-10 17-17 28-12 17-11 13-9 10-7 8-9 10-10 9-1 3 4 1 15 6 33 15 17 9 14 7 22 13 23 14 16 10 11 8 10 9 8 8 7 10 8 16 3 10v24l-3 13-8 16-9 13-10 11-13 8-19 7-6 1h-24l-17-5-16-8-17-9-40-24-26-14-23-10-35-14-28-10-32-8-44-10-35-4-41-3-10-1h-28l-54 4-33 4-37 8-45 12-24 8-32 13-31 13-22 12-14 8-28 17-18 12-11 8-16 12-13 11-9 7-9 8-11 9-23 23-8 10-5 5-9 10-7 8-12 14-9 11-9 13-12 19-10 15-17 29-8 16-10 21-14 34-8 24-3 17v15l5 17 8 16 11 13 12 9 15 7 19 5 8 1 38 1h643l24 2 14 3 9 4 12 7 13 12 9 13 6 12 5 15 1 7v10l-4 18-9 19-8 12-9 10-5 4-11 5-13 5h-3l2 5 3 1v1h-769l2-1v-2l4-1 15-1 3-1-26-5-20-6-26-9-16-8-20-12-13-10-12-11-7-6-7-8-7-7-13-17-12-18-14-27-6-15-9-27v-3h-2l-1-7h-2l-1-3v-77l2 4 12-41 9-26 10-26 12-27 12-25 13-25 11-19 8-13 9-14 12-17 8-12 7-9 12-16 11-14 11-12 9-11 8-10h2l2-4 16-17 9-9 8-7 7-7 8-7 10-9 11-9 15-12 17-13 18-13 16-11 15-10 25-15 24-14 27-14 24-11 16-7 23-9h3l-1-4-10-13-10-11-9-11-8-9-12-16-11-17-13-22-13-24-8-17-10-27-8-26-6-24-4-24-4-33-1-13v-23l5-43 4-27 6-24 12-36 8-20 11-23 10-18 10-17 11-16 12-16 13-16 9-10 3-4h2l2-4 4-4h2l2-4 8-7 10-9 14-11 10-8 13-9 15-10 25-14 15-8 26-11 21-7 28-8 32-6 27-3 32-2h19l30 2 26 3 26 5 25 7 23 8 21 9 16 7 23 13 17 10 19 13 15 12 11 9 20 18 8 8 7 8 12 13 11 14 9 12 16 24 13 23 8 16 6 14 2 2 9-1 18-12 16-10 18-12 26-15 54-27 21-8 6-3 1-4-6-9-15-16-7-8-10-11-12-16-11-17-10-17-12-21-12-25-9-25-11-34-5-23-3-21-4-41v-29l5-47 4-22 6-23 12-36 8-20 8-16 10-19 8-14 12-19 14-18 9-10 16-20 20-20 11-9 14-12 14-11 14-10 26-15 16-9 26-12 35-12 38-10 7-1-8-1-2-1zm20 4m130 1v1l8 1v-2zm-83 155-25 3-22 5-20 6-25 11-16 9-13 9-12 9-11 9-12 11-9 10-8 9-4 5v2h-2l-14 21-6 11-11 22-7 18-6 23-3 17-3 29v17l4 36 5 21 8 24 11 24 11 19 10 14 14 17 6 7 6 5 5 5 10 9 19 14 15 9 24 13 21 8 27 7 25 4 9 1h28l34-4 21-5 26-9 17-8 20-11 15-10 10-8 15-13 17-17 8-10 7-8 7-11 6-10 13-26 9-29 6-26 3-21v-35l-4-31-4-18-11-33-12-25-11-18-14-19-11-12-3-4h-2l-2-4h-2v-2l-11-9-14-11-19-12-18-10-24-10-16-5-21-5-22-3-12-1zm-832 547-23 3-25 6-18 6-25 12-14 8-16 11-17 14-8 7-11 11v2h-2l-9 11-14 19-7 11-6 11-9 19-10 28-5 21-3 19-1 11v32l2 20 5 24 6 20 10 25 12 23 10 15 10 13 11 12 9 10 14 12 18 14 28 16 17 8 27 9 21 5 21 3 11 1h27l30-4 28-6 25-9 16-8 15-8 12-8 14-10 13-11 8-7 10-10 9-11 10-13 12-20 8-15 10-26 6-20 4-20 2-17 1-24-1-21-4-27-5-21-6-18-9-20-8-16-8-13-8-12-9-11-9-10-6-7-8-7-13-11-16-11-15-9-19-10-20-8-15-5-17-4-31-4z" />
                                        <path transform="translate(1959,1289)" d="m0 0 18 1 15 4 12 5 13 9 11 11 11 17 6 12 1 3 2-1v40h-2l2 4v8l-1-2-2-1v-1h-2l-1-2-13 23-13 18-17 25-10 13-14 20-8 12-12 16-12 17-8 11-24 34-9 12-13 19-11 15-13 18-12 17-13 18-8 11-13 18-15 22-15 20-10 14-24 34-12 16-13 19-10 14-11 15-13 18-13 19-14 19-10 14-12 17-13 16-9 10-17 17-20 15-19 11-19 9-19 7-21 6-9 2-1 1h-49l-3-3-9-3-27-6-12-4-18-8-17-10-12-8-17-12-13-11-11-10-8-7-17-17-3-2v-2l-4-2-22-22-8-7-13-13-8-7-25-25-8-7v-2l-4-2-29-29-8-7-17-17-8-7-18-18-8-7-12-12-6-5-7-8-9-11-9-14-6-12-4-17v-11l5-21 6-12 8-11 9-10 13-10 10-5 14-5 6-1h17l13 3 18 8 15 10 15 13 14 14 8 7 11 11 8 7 17 17 2 1v2l4 2 22 22 8 7 22 22 8 7 18 18 8 7 18 18 8 7 21 21 8 7 10 10 8 7 11 10 14 11 13 7 12 3 11-1 11-6 11-10h2l2-4 9-11 8-12 10-13 10-14 11-15 12-17 10-14 14-20 10-14 16-22 10-14 12-17 13-18 12-17 13-18 10-14 6-8 10-14 12-17 13-18 10-14 12-17 8-11 10-14 26-36 12-17 11-15 11-16 13-18 7-10 10-14 12-17 11-16 12-16 12-14 7-7 13-9 11-5 12-3z" />
                                        <path transform="translate(1421,2046)" d="m0 0 5 1v1h-6z" />
                                        <path transform="translate(2045,883)" d="m0 0v3l-2 1z" />
                                        <path transform="translate(1501,2047)" d="m0 0h5v1h-5z" />
                                        <path transform="translate(1513,2046)" d="m0 0 2 1-2 1z" />
                                        <path transform="translate(2047,887)" d="m0 0" />
                                        <path transform="translate(1507,2047)" d="m0 0" />
                                        <path transform="translate(207,2041)" d="m0 0" />
                                        <path transform="translate(2047,880)" d="m0 0" />
                                    </svg>

                                </>
                        }
                    </motion.button>
                    </> :
                    <>

                        <motion.button
                            className={`   ${className}`}
                            style={{
                                cursor: "pointer",
                                // border: className == "c-rl" ? "solid 1px #ffffff9f" : "solid 1px var(--border-color)",
                                transition: '.1s'
                            }}
                            onClick={handelAddFollowing}
                        >
                            {
                                isIsLodingFollo ?
                                    <L_loader style={{ borderColor: className ? "solid 1px #fff" : "var(--bg-secondary)" }} />
                                    :
                                    <>
                                        {
                                            followers.includes(user_id) ?
                                                <>
                                                    Refollow
                                                    <svg style={{ fill: "none", strokeWidth: 2 }} xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" width={32} height={32} strokeWidth={1.25}> <path d="M8 7a4 4 0 1 0 8 0a4 4 0 0 0 -8 0"></path> <path d="M6 21v-2a4 4 0 0 1 4 -4h3.5"></path> <path d="M20 21l2 -2l-2 -2"></path> <path d="M17 17l-2 2l2 2"></path> </svg>
                                                </>

                                                :
                                                <>
                                                    Follow
                                                    <svg version="1.1" viewBox="0 0 2048 2048" className='ml5' xmlns="http://www.w3.org/2000/svg">
                                                        <path transform="translate(642,1087)" d="m0 0h394l43 2 34 3 29 4 34 7 37 11 20 7 33 13 33 16 18 10 22 13 22 15 16 12 14 11 10 9 11 9 16 15 8 7 8 8 7 8 10 11 9 11 10 12 10 13 12 17 15 23 15 26 18 36 11 26 13 37 9 32 8 37 5 35 3 34v54l-3 30-6 29-9 30-9 22-9 20-14 24-10 15-8 11-11 13-18 20-8 8-8 7-9 8-13 10-10 7-14 9-18 10-25 12-21 8-28 8-25 5-24 3-26 2-29 1h-256l-16-2-9-4-9-6-8-7-10-13-5-10-3-9-1-5v-14l3-13 6-12 10-13h2v-2l13-10 10-6 5-1 16-1 258-1 34-2 30-5 18-5 24-10 17-10 16-11 10-8 10-9 10-10 11-14 10-15 11-20 7-19 7-28 3-19 1-9v-33l-3-31-5-33-11-44-14-38-11-24-13-25-14-23-14-20-14-18-11-13-12-13-11-11-11-9-12-11-19-14-30-20-21-12-21-11-34-14-33-11-25-6-39-6-31-3-18-1-119-1h-233l-67 1-47 3-24 3-35 7-24 7-20 7-27 11-16 8-17 9-15 9-21 14-12 9-13 10-12 11-10 8-24 24-9 11-10 12-18 24-11 17-14 25-8 16-9 19-14 37-5 17-6 27-6 36-3 28v35l5 33 8 27 7 17 12 22 10 14 12 14 14 14 11 9 14 10 21 12 21 9 24 7 18 3 21 2 20 1 243 1 33 2 12 4 10 7 9 8 8 10 7 14 2 8v23l-4 12-6 10-11 13-8 7-12 6-15 2-17 1-41 1h-224l-35-2-31-4-19-4-36-12-16-7-21-10-23-14-16-11-22-18-8-8-8-7v-2l-4-2v-2h-2l-7-8-9-10-11-14-12-17-9-15-13-24-9-21-7-18-8-29-5-25-3-25v-58l3-31 6-39 9-40 8-28 12-33 12-28 14-29 15-27 8-13 10-15 7-10 12-17 11-14 10-11 7-8 14-15 27-27 11-9 11-10 28-21 30-20 22-13 14-8 32-16 27-11 28-10 24-7 34-8 30-5 30-3 37-2z" />
                                                        <path transform="translate(806,64)" d="m0 0h50l37 3 32 5 25 6 26 8 26 10 25 11 22 12 16 9 23 15 15 11 16 13 10 9 8 7 16 15 14 15 12 14 12 16 13 18 12 19 10 18 10 19 13 30 10 28 6 22 7 29 4 26 3 32v52l-3 34-5 30-7 30-8 27-11 28-9 20-8 16-9 16-8 13-18 27-12 16-13 15-11 12-24 24-14 11-10 9-12 9-16 11-23 14-18 10-29 14-37 14-27 8-30 7-25 4-30 3-17 1h-40l-25-2-34-5-30-7-33-10-25-10-18-8-26-13-25-15-17-12-16-12-10-8-14-12-8-8-8-7-8-8v-2h-2l-7-8-11-12-11-14-10-13-16-24-14-24-10-19-12-27-10-28-7-22-7-29-6-39-2-22v-55l2-24 6-37 9-36 10-30 15-36 8-16 10-18 6-10 9-14 8-12 8-11 13-16 7-8 12-13 28-28 11-9 12-10 19-14 17-11 18-11 28-15 30-13 36-12 23-6 25-5 35-4zm2 128-28 3-28 6-27 8-22 9-23 11-19 11-17 12-13 10-10 9-16 14-5 6-5 5-7 8v2h-2l-10 13-11 16-7 11-10 18-12 25-8 21-7 27-6 31-3 25v40l5 36 7 30 10 30 12 27 12 21 16 24 13 16 7 8 9 10 9 9 11 9 9 8 18 13 17 11 18 10 25 12 21 8 21 6 30 6 26 3 18 1h14l26-2 30-5 25-6 27-9 24-11 22-12 16-10 19-14 13-11 8-7 23-23 11-14 10-13 11-17 10-18 8-16 10-26 8-28 6-30 3-24v-40l-4-36-5-26-9-30-10-24-12-25-15-24-10-14-11-14-14-15-11-11-11-9-15-12-21-14-21-12-16-8-16-7-18-7-21-6-31-6-27-3z" />
                                                        <path transform="translate(1624,511)" d="m0 0h11l16 3 16 8 8 7 7 7 7 11 4 9 2 8v235h215l26 2 11 4 11 7 10 10 9 13 5 13 1 4v19l-4 15-7 12-13 16-11 7-8 3-18 2-40 1h-186v61l-1 160-1 17-4 12-7 11-10 12-11 8-10 4-10 2h-21l-15-4-11-6-9-7-8-9-6-9-4-12-1-9-1-27-1-50v-80l1-75-65 1h-164l-16-3-13-7-13-12-9-13-5-12-2-7v-17l4-15 5-10 12-14 11-9 11-7 4-1 13-1 220-1 5-1 1-2v-177l1-43 2-17 6-12 10-13 8-8 10-7 11-5z" />
                                                    </svg>
                                                </>
                                        }

                                    </>
                            }
                        </motion.button>

                    </>
            }
        </>
    )
}

export default Btn_follow
